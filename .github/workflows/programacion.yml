name: Ejecuci贸n Diaria Autom谩tica

on:
  # 1. Programaci贸n (Schedule)
  schedule:
    # 22:00 UTC = 23:00 en Espa帽a (Invierno) / 00:00 en Espa帽a (Verano)
    - cron: '0 22 * * *'
  
  # 2. Bot贸n manual (Para que puedas probarlo YA si quieres)
  workflow_dispatch:

jobs:
  trabajo-diario:
    runs-on: ubuntu-latest
    
    steps:
    - name:  Descargar c贸digo
      uses: actions/checkout@v4

    - name:  Instalar Ruby
      uses: ruby/setup-ruby@v1
      with:
        ruby-version: '3.2'
        bundler-cache: true

    # Necesitamos instalar Chrome para Selenium (aunque sea headless)
    - name:  Instalar Chrome (Necesario para Selenium)
      uses: browser-actions/setup-chrome@v1

    - name:  Instalar dependencias
      run: |
        bundle config set --local deployment 'true'
        bundle config set --local without 'development test'
        bundle install

    - name:  Ejecutar Scraper Tesla Diario
      env:
        AI_DATABASE_URL: ${{ secrets.AI_DATABASE_URL }}
        GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        RAILS_ENV: production
        
        # DEFINIMOS LA MARCA Y EL MODO SERVIDOR
        BRAND: "Tesla"
        CI: "true" 


        SECRET_KEY_BASE: "una_clave_super_secreta_y_larga_123456789_inventada_por_mi"
      run: |
        bundle exec rake import:autodata