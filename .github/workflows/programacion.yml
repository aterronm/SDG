name: EjecuciÃ³n Diaria AutomÃ¡tica

on:
  # 1. ProgramaciÃ³n (Schedule)
  schedule:
    # 22:00 UTC = 23:00 en EspaÃ±a (Invierno) / 00:00 en EspaÃ±a (Verano)
    - cron: '0 22 * * *'
  
  # 2. BotÃ³n manual (Para que puedas probarlo YA si quieres)
  workflow_dispatch:

jobs:
  trabajo-diario:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Descargar cÃ³digo
      uses: actions/checkout@v4

    - name: ğŸ’ Instalar Ruby
      uses: ruby/setup-ruby@v1
      with:
        ruby-version: '3.2'
        bundler-cache: true

    # Necesitamos instalar Chrome para Selenium (aunque sea headless)
    - name: ğŸŒ Instalar Chrome (Necesario para Selenium)
      uses: browser-actions/setup-chrome@v1

    - name: ğŸ“¦ Instalar dependencias
      run: |
        bundle config set --local deployment 'true'
        bundle config set --local without 'development test'
        bundle install

    - - name: ğŸš€ 5. EJECUTAR ROBOT
      env:
        # âœ… BIEN: Le damos a Rails lo que quiere, usando tu secreto
        DATABASE_URL: ${{ secrets.AI_DATABASE_URL }}
        
        # El resto dÃ©jalo igual...
        GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        RAILS_ENV: production
        BRAND: "Tesla" # O la que quieras
        CI: "true"
        SECRET_KEY_BASE: "una_clave_super_secreta_y_larga_123456789_inventada_por_mi"
      run: |
        bundle exec rake import:autodata